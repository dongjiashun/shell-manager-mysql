#!/bin/sh
### author : guweitao
### date : 2015-09-09
### func : check qps,tps of mysql


export PATH=$PATH:/usr/local/mysql56/bin:/usr/local/bin

MBASE=/usr/local/mysql56/bin
MUSER=mstdba_mgr
MPASS=xxxxxxx
MHOST=127.0.0.1
MPORT=3308

usage()
{
	echo "USAGE: $0 -p PORT
	e.g. $0 -p 3001
			"
	exit 1
}

if [ AA"$1" != AA"-p" ]
then
	usage;
elif [ $# != 2 ];then
	usage;
elif [ $2 -lt 3000 ] || [ $2 -gt 4000 ];then
	usage;
else
	MPORT=$2	
fi

$MBASE/mysqladmin  -u$MUSER  -p$MPASS -h $MHOST -P $MPORT  extended-status -i1 |\
awk 'BEGIN{print "QPS   Com_commit     Com_rollback     Threads_con    Threads_run      TPS\n \
 ---------------------------------------------------------------------------\n"} \
/Queries/{q=$4-qp;qp=$4}\
/Com_commit/{com=$4-qc;qc=$4}\
/Com_rollback /{rol=$4-cr;cr=$4}\
/Threads_connected/{tc=$4}\
/Threads_running/{printf "%10d %10d %10d %10d %10d %10d\n",q,tc,com, rol,$4,com + rol}'




